package Analyzer;

import java_cup.runtime.*;
import Interpreter.Instruction.*;
import Interpreter.Objeto.*;
import Interpreter.Operation.*;
import Principal.*;
import java.util.LinkedList;

parser code
{:
    /* RAIZ */
    Principal p;

    /**
    *   Metodo que retorna la raiz del arbol
    **/
    public Principal GetAst(){
        return p;
    }
    /**
     * Método al que se llama automáticamente ante algún error sintactico.
     **/
    public void syntax_error(Symbol s){
            System.out.println("Error sintactico en la linea: " + (s.left) +" Columna: " +s.right+ ". No se esperaba este componente: " + s.value+"."); 
            Singleton.getInstance().addError(s.left,s.right,"Sintactico : No se esperaba este componente: " + s.value+".");
           
 }
    /**
     * Método al que se llama en el momento en que ya no es posible una recuperación de errores.
     **/
    public void unrecovered_syntax_error(Symbol s) throws java.lang.Exception{
            System.out.println("Error Sintactico irrecuperable en la Lienea " + (s.left)+ " Columna "+s.right+". Componente " + s.value + " no reconocido.");
            Singleton.getInstance().addError(s.left,s.right,"Sintactico : No se esperaba este componente: " + s.value+".");
           
 }
:}

terminal String NLO,FUSIONR,ENTR,ZROR,CHRR,DECR,BULR,IFR,WHILER,FORR,REPEATR,SWITCHR,CASER,DEFAULTR,ROMPERR,SIGAR,DEFINIRR,IMPORTARR,REGRESARR,WHENR,RSTRINGR;
terminal String NUMERAL,LEFT_BRACKET,RIGHT_BRACKET,LEFT_BRACES,RIGHT_BRACES,LEFT_PARENT,RIGHT_PARENT,COMMA,SEMI,EQ,NOT_EQ,PLUS,MINUS,TIMES,POT,MOD,DIV,GTR,GTR_EQ,LSS,LSS_EQ;
terminal String AND,OR,NOT,DOT,TWO_POINTS,ENT_LIT,DEC_LIT,BOOL_LIT,STRING_LIT,CHAR_LIT,ID,ELSER,UMINUS,UPLUS,RLBL,RTXT,RTXTA,RTXTP,RTXTN,RBTON,RMENSAGE;
terminal String RREAD,RAPEND,RCLOSE,RWRITE,RIMP,RWF,PLUSPLUS,MINUSMINUS,MAIN,ASIG;

non terminal S;

non terminal LinkedList<Instruction> InstructionList,Instructions,CaseList,Declarations;
non terminal Instruction Instruction,IfDef,ReturnDef,RomperDef,SigaDef,SwitchDef,RepeatDef,WhileDef,ForDef,AssigmentDef,CallDef,ElseDef,DefaultCase,StatementDef,
             VarDef,FunctionsDef,Declaration,ImportDef,StructDef,ConstDef,NucleoDef,FunctionsDefGui,InputOutputDef;

non terminal Parameter Attribute,Param;
non terminal LinkedList<Parameter> AttributeList,ParamList,Params;
non terminal Objeto Type;

non terminal LinkedList<String> IdList;

non terminal LinkedList<Operation> ExprList;
non terminal Operation Constant,BinExpr,Logical,Arithmetic,Relational,UnExpr,PostExpr,Access,Expr,ArrayDec;

non terminal Arreglo ArrayParam,ArrayList;

precedence left OR;
precedence left AND;
precedence left NOT_EQ,EQ;
precedence nonassoc GTR,GTR_EQ,LSS,LSS_EQ;
precedence left PLUS,MINUS;
precedence left TIMES,DIV,MOD;
precedence left POT;
precedence right NOT,UMINUS,UPLUS,PLUSPLUS,MINUSMINUS;
precedence left LEFT_PARENT,RIGHT_PARENT,LEFT_BRACKET,RIGHT_BRACKET;

start with S;

S ::= Declarations : arg0
    {:
        p = new Principal(arg0);
    :}
;

Declarations::= Declarations:arg0 Declaration:arg1
    {:
    :}
    | Declaration:arg0
    {:
    :}
;

Declaration ::= ImportDef:arg0
    {:
    :}
    | StructDef:arg0
    {:
    :}
    | ConstDef : arg0
    {:
    :}
    | VarDef : arg0
    {:
    :}
    | FunctionsDef : arg0
    {:
    :}
    | NucleoDef : arg0
    {:
    :}
    | FunctionsDefGui : arg0
    {:
    :}
;

NucleoDef ::= ZROR MAIN : arg0 LEFT_PARENT RIGHT_PARENT LEFT_BRACES  Instructions:arg1 RIGHT_BRACES
    {:
    :}
;

ImportDef ::= NUMERAL IMPORTARR STRING_LIT:arg0
    {:
    :}
;

StructDef ::= FUSIONR ID:arg0 LEFT_BRACES AttributeList:arg1 RIGHT_BRACES SEMI
    {:
    :}
;

AttributeList ::= AttributeList : arg0 Attribute : arg1
    {:
    :}
    | Attribute : arg0
    {:
    :}
;

Attribute ::= Type : arg0 ID : arg1 SEMI
    {:
    :}
    | Type : arg0 ID : arg1 ArrayList : arg2 SEMI
    {:
    :}
;

Type ::= ENTR
    {:
    :}
    | CHRR
    {:
    :}
    | DECR
    {:
    :}
    | BULR
    {:
    :}
    | ID : arg0
    {:
    :}
    | RLBL
    {:
    :}
    | RTXT
    {:
    :}
    | RTXTA
    {:
    :}
    | RTXTN
    {:
    :}
    | RTXTP
    {:
    :}
    | RBTON
    {:
    :}
    | RSTRINGR
    {:
    :}
;


ArrayList ::= ArrayList : arg0 LEFT_BRACKET Expr : arg1 RIGHT_BRACKET
    {:
    :}
    | LEFT_BRACKET Expr:arg0 RIGHT_BRACKET
    {:
    :}
;

ArrayParam ::= ArrayParam : arg0 LEFT_BRACKET RIGHT_BRACKET
    {:
    :}
    | LEFT_BRACKET RIGHT_BRACKET
    {:
    :}
;

ConstDef ::= NUMERAL DEFINIRR ID : arg0 Expr : arg1
    {:
    :}
;

VarDef ::= Type : arg0 IdList : arg1 SEMI
    {:
    :}
    | Type : arg0 IdList : arg1 ASIG Expr : arg2 SEMI
    {:
    :}
    | Type : arg0 IdList : arg1 ASIG TIMES Access : arg2 SEMI
    {:
    :}
    | Type : arg0 IdList : arg1 ArrayParam : arg2 ASIG Expr : arg3 SEMI 
    {:
    :}
    | Type : arg0 IdList : arg1 ArrayParam : arg2 ASIG TIMES Access : arg3 SEMI 
    {:
    :}
    | Type : arg0 IdList : arg1 ArrayList : arg2 SEMI
    {:
    :}
    | Type : arg0 IdList : arg1 ArrayList : arg2 ASIG Expr : arg3 SEMI
    {:
    :}
    | Type : arg0 IdList : arg1 ArrayList : arg2 ASIG TIMES Access : arg3 SEMI
    {:
    :}
;

IdList ::= IdList : arg0 COMMA ID : arg1
    {:
    :}
    | ID : arg0
    {:
    :}
;

FunctionsDef ::= ZROR ID : arg0 LEFT_PARENT Params : arg1 RIGHT_PARENT LEFT_BRACES Instructions : arg2 RIGHT_BRACES
    {:
    :}
    | Type : arg0 ID : arg1 LEFT_PARENT Params : arg2 RIGHT_PARENT LEFT_BRACES Instructions : arg3 RIGHT_BRACES
    {:
    :}
    | Type : arg0 ArrayParam : arg1 ID : arg2 LEFT_PARENT Params : arg3 RIGHT_PARENT LEFT_BRACES Instructions : arg4 RIGHT_BRACES
    {:
    :}
;

FunctionsDefGui ::= ZROR ID : arg0 TWO_POINTS ID : arg1 LEFT_PARENT RIGHT_PARENT LEFT_BRACES Instructions : arg2 RIGHT_BRACES
    {:
    :}
;

Params ::= ParamList : arg0
    {:
    :}
    | /* empty */
    {:
    :}
;

ParamList ::= ParamList : arg0 COMMA Param : arg1
    {:
    :}
    | Param : arg0
    {:
    :}
;

Param ::= Type : arg0 ID : arg1
    {:
    :}
    | Type : arg0 ID : arg1 ArrayParam : arg2
    {:
    :}
;

Instructions ::= InstructionList : arg0
    {:
    :}
    | /* empty */
    {:
    :}
;

InstructionList ::= InstructionList : arg0 Instruction : arg1
    {:
    :}
    | Instruction : arg0
    {:
    :}
;

Instruction ::= ReturnDef : arg0
    {:
    :}
    | RomperDef : arg0
    {:
    :}
    | SigaDef : arg0
    {:
    :}
    | IfDef : arg0
    {:
    :}
    | SwitchDef : arg0
    {:
    :}
    | WhileDef : arg0
    {:
    :}
    | RepeatDef : arg0
    {:
    :}
    | ForDef : arg0
    {:
    :}
    | AssigmentDef : arg0 SEMI
    {:
    :}
    | CallDef : arg0
    {:
    :}
    | VarDef : arg0
    {:
    :}
    | StatementDef : arg0
    {:
    :}
    | InputOutputDef : arg0
    {:
    :}
;

ReturnDef ::= REGRESARR Expr : arg0 SEMI
    {:
    :}
    | REGRESARR : arg0 SEMI
    {:
    :}
;

RomperDef ::= ROMPERR : arg0 SEMI
    {:
    :}
;

SigaDef ::= SIGAR : arg0 SEMI
    {:
    :}
;

IfDef ::= IFR LEFT_PARENT Expr : arg0 RIGHT_PARENT LEFT_BRACES Instructions : arg1 RIGHT_BRACES
    {:
    :}
    | IFR LEFT_PARENT Expr : arg0 RIGHT_PARENT LEFT_BRACES Instructions : arg1 RIGHT_BRACES ElseDef : arg2
    {:
    :}
;

ElseDef ::= ELSER IfDef : arg0
    {:
    :}
    | ELSER : arg0 LEFT_BRACES Instructions : arg1 RIGHT_BRACES
    {:
    :}
;

WhileDef ::= WHILER LEFT_PARENT Expr : arg0 RIGHT_PARENT LEFT_BRACES Instructions : arg1 RIGHT_BRACES
    {:
    :}
;

RepeatDef ::= REPEATR LEFT_BRACES Instructions : arg0 RIGHT_BRACES WHENR LEFT_PARENT Expr : arg1 RIGHT_PARENT SEMI
    {:
    :}
;

ForDef ::= FORR LEFT_PARENT VarDef : arg0 Expr : arg1 SEMI AssigmentDef : arg2 RIGHT_PARENT LEFT_BRACES Instructions : arg3 RIGHT_BRACES
    {:
    :}
    | FORR LEFT_PARENT AssigmentDef : arg0 SEMI Expr : arg1 SEMI AssigmentDef : arg2 RIGHT_PARENT LEFT_BRACES Instructions : arg3 RIGHT_BRACES
    {:
    :}
;

SwitchDef ::= SWITCHR LEFT_PARENT Expr : arg0 RIGHT_PARENT LEFT_BRACES CaseList : arg1 DefaultCase : arg2 RIGHT_BRACES
    {:
    :}
;

CaseList ::= CaseList : arg0 CASER Expr : arg1 TWO_POINTS Instructions : arg2
    {:
    :}
    | CASER Expr : arg0 TWO_POINTS Instructions : arg1
    {:
    :}
;

DefaultCase ::= DEFAULTR : arg0 TWO_POINTS Instructions : arg1
    {:
    :}
    | /*empty*/
    {:
    :}
;

StatementDef ::= LEFT_BRACES Instructions : arg0 RIGHT_BRACES
    {:
    :}
;

CallDef ::= Access : arg0 SEMI
    {:
    :}
;

AssigmentDef ::= Access : arg0 ASIG Expr : arg1
    {:
    :}
    | Access : arg0 ASIG TIMES Access : arg1
    {:
    :}
    | Access : arg0 PLUSPLUS
    {:
    :}
    | Access : arg0 MINUSMINUS
    {:
    :}
;

InputOutputDef ::= RIMP : arg0 LEFT_PARENT ExprList : arg1 RIGHT_PARENT SEMI
    {:
    :}
    | RWRITE : arg0 LEFT_PARENT Expr : arg1 RIGHT_PARENT SEMI
    {:
    :}
    | RAPEND : arg0 LEFT_PARENT Expr : arg1 RIGHT_PARENT SEMI
    {:
    :}
    | RWF : arg0 LEFT_PARENT ExprList : arg1 RIGHT_PARENT SEMI
    {:
    :}
    | RCLOSE : arg0 LEFT_PARENT RIGHT_PARENT SEMI
    {:
    :}
    | RREAD : arg0 LEFT_PARENT Expr : arg1 COMMA Expr : arg2 RIGHT_PARENT SEMI
    {:
    :}
    | RMENSAGE : arg0 LEFT_PARENT ExprList : arg1 RIGHT_PARENT SEMI
    {:
    :}
;

ExprList ::= ExprList : arg0 COMMA Expr : arg1
    {:
    :}
    | Expr : arg0
    {:
    :}
;

Expr ::= Constant : arg0    
    {:
    :}
    | BinExpr : arg0
    {:
    :}
    | UnExpr : arg0
    {:
    :}
    | Access : arg0
    {:
    :}
    | LEFT_PARENT Expr : arg0 RIGHT_PARENT
    {:
    :}
    | ArrayDec : arg0
    {:
    :}
;

Constant ::= ENT_LIT : arg0
    {:
    :}
    | CHAR_LIT : arg0
    {:
    :}
    | BOOL_LIT : arg0
    {:
    :}
    | DEC_LIT : arg0
    {:
    :}
    | NLO : arg0
    {:
    :}
    | STRING_LIT : arg0
    {:
    :}
;

BinExpr ::= Arithmetic : arg0
    {:
    :}
    | Logical : arg0
    {:
    :}
    | Relational : arg0
    {:
    :}
    | PostExpr : arg0
    {:
    :}
;

UnExpr::= MINUS Expr : arg0
    {:
    :}
    %prec UMINUS
    | NOT Expr : arg0
    {:
    :}
    | PLUS Expr : arg0
    {:
    :}
    %prec UPLUS
;

PostExpr ::= Expr : arg0 PLUSPLUS
    {:
    :}
    | Expr : arg0 MINUSMINUS
    {:
    :}
;

Arithmetic ::= Expr : arg0 PLUS Expr : arg1
    {:
    :}
    | Expr : arg0 MINUS Expr : arg1
    {:
    :}
    | Expr : arg0 TIMES Expr : arg1
    {:
    :}
    | Expr : arg0 DIV Expr : arg1
    {:
    :}
    | Expr : arg0 POT Expr : arg1
    {:
    :}
    | Expr : arg0 MOD Expr : arg1
    {:
    :}
;

Logical ::= Expr : arg0 OR Expr : arg1
    {:
    :}
    | Expr : arg0 AND Expr : arg1
    {:
    :}
;

Relational ::= Expr : arg0 LSS Expr : arg1
    {:
    :}
    | Expr : arg0 LSS_EQ Expr : arg1
    {:
    :}
    | Expr : arg0 GTR Expr : arg1
    {:
    :}
    | Expr : arg0 GTR_EQ Expr : arg1
    {:
    :}
    | Expr : arg0 EQ Expr : arg1
    {:
    :}
    | Expr : arg0 NOT_EQ Expr : arg1
    {:
    :}
;

Access ::= ID : arg0
    {:
    :}
    | ID : arg0 LEFT_PARENT ExprList : arg1 RIGHT_PARENT
    {:
    :}
    | ID : arg0 LEFT_PARENT RIGHT_PARENT
    {:
    :}
    | Access : arg0 DOT ID : arg1
    {:
    :}
    | Access : arg0 LEFT_BRACKET Expr : arg1 RIGHT_BRACKET
    {:
    :}
    | Access : arg0 DOT ID : arg1 LEFT_PARENT ExprList : arg2 RIGHT_PARENT
    {:
    :}
    | Access : arg0 DOT ID : arg1 LEFT_PARENT RIGHT_PARENT
    {:
    :}
;

ArrayDec ::= LEFT_BRACES : arg0 ExprList : arg1 RIGHT_BRACES
    {:
    :}
;